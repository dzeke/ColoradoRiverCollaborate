for (iRes in 919) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
# Read in the data
#tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
# #Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
#
#
dfResData <- rbind(dfResData,  dfTemp)
#  },
#  error = {print(paste("Did not read ", sResFieldURL ))
# })
}
}
View(dfResData)
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
# Loop over the reservoirs and fields
#for (iRes in dfReservoirs$ResID) {
for (iRes in 919) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
dfTemp <- try(read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=","))
if (!inherits(dfTemp, "try-error")) {
# Proceed with data processing if no error occurred
print(paste("Successfully read", sResFieldURL))
} else {
print(paste("Skipping", sResFieldURL, "due to an error"))
}
# Read in the data
#tryCatch({
# dfTemp <- read.csv(file=sResFieldURL,
#                    header=TRUE,
#
#                    stringsAsFactors=FALSE,
#                    sep=",")
# # #Add the Field ID and change the second column from the field name to value
# colnames(dfTemp)[2] <- "Value"
#
# dfTemp$FieldID <- iField
# dfTemp$ResID <- iRes
# #
# #
#  dfResData <- rbind(dfResData,  dfTemp)
#  },
#  error = {print(paste("Did not read ", sResFieldURL ))
# })
}
}
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
# Loop over the reservoirs and fields
#for (iRes in dfReservoirs$ResID) {
for (iRes in 921) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
dfTemp <- try(read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=","))
if (!inherits(dfTemp, "try-error")) {
# Proceed with data processing if no error occurred
print(paste("Successfully read", sResFieldURL))
} else {
print(paste("Skipping", sResFieldURL, "due to an error"))
}
# Read in the data
#tryCatch({
# dfTemp <- read.csv(file=sResFieldURL,
#                    header=TRUE,
#
#                    stringsAsFactors=FALSE,
#                    sep=",")
# # #Add the Field ID and change the second column from the field name to value
# colnames(dfTemp)[2] <- "Value"
#
# dfTemp$FieldID <- iField
# dfTemp$ResID <- iRes
# #
# #
#  dfResData <- rbind(dfResData,  dfTemp)
#  },
#  error = {print(paste("Did not read ", sResFieldURL ))
# })
}
}
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
# Loop over the reservoirs and fields
for (iRes in dfReservoirs$ResID) {
#for (iRes in 921) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
dfTemp <- try(read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=","))
if (!inherits(dfTemp, "try-error")) {
# Proceed with data processing if no error occurred
print(paste("Successfully read", sResFieldURL))
# Change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
# Add reservoir and field codes as new fields
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
#
#
dfResData <- rbind(dfResData,  dfTemp)
} else {
print(paste("Skipping", sResFieldURL, "due to an error"))
}
# Read in the data
#tryCatch({
# dfTemp <- read.csv(file=sResFieldURL,
#                    header=TRUE,
#
#                    stringsAsFactors=FALSE,
#                    sep=",")
# # #Add the Field ID and change the second column from the field name to value
# colnames(dfTemp)[2] <- "Value"
#
# dfTemp$FieldID <- iField
# dfTemp$ResID <- iRes
# #
# #
#  dfResData <- rbind(dfResData,  dfTemp)
#  },
#  error = {print(paste("Did not read ", sResFieldURL ))
# })
}
}
View(dfReservoirs)
dfResData <- left_join(dfResData, dfReservoirs, by = "ResID")
dfResData <- left_join(dfResData, dfFields, by = "FieldID")
dfResData <- dfResData %>% slice(-1)
dDateInterval <- 365 # Days
#Convert date text to date value
dfResData$DateValue <- as.POSIXct(dfResData$datetime)
dfResData$DateValue <- ymd(dfResData$datetime)
nCFStoAFMon <- 60.37
nCFStoAFDay <- nCFStoAFMon/30.5
nCFSToAF <- nCFStoAFDay
#Calculate Day, Month, and Year
dfResData$Year <- year(dfResData$DateValue)
dfResData$Month <- month(dfResData$DateValue)
dfResData$Day <- day(dfResData$DateValue)
#Calculate Water Year
dfResData$WaterYear <- ifelse(dfResData$Month >= 10, dfResData$Year + 1, dfResData$Year)
View(dfFields)
dfTemp <- dfResData %>% filter(Year == 2000, Month == 10, Day ==1)
View(dfTemp)
# This script auto reads USBR Lake Powell and Lake Mead data from Reclamation's HydroData Web portal
#
# https://www.usbr.gov/uc/water/hydrodata/reservoir_data/site_map.html
# This is a beginning R-programming effort! There could be lurking bugs or basic coding errors that I am not even aware of.
# Please report bugs/feedback to me (contact info below)
#
# We auto-read all Lake Powell (Code 919) and Lake Mead (921) available data at the daily time step.
#
# This data is:
#  Lake Powell (919) and field (code)
#     Storage - 17
#     Evaporation - 25
#     Inflow - 29
#     Inflow volume - 30
#     Unregulated inflow - 33
#     Unregulated inflow volume - 34
#     Total Release - 42
#     Release volume - 43
#     Area - 89
#     Pool elevation - 49
#  Lake Mead (921)
#     Storage - 17
#     Total Release - 42
#     Pool elevation - 49
#     Release volume - 43
#
#  The auto read URL command is:
#  'https://www.usbr.gov/uc/water/hydrodata/reservoir_data/RESID/csv/FIELDID.csv'
#
# The data wrangling strategy is:
#   1. Loop through Reservoirs and Fields
#   2.   Auto download the individual field CSV file format
#   2. Combine into one data frame for each reservoir with columns as fields
#   4. Clean and covert Reclamation's date format to a format R understands
#   5. Move into Narrow format - [Date][Reservoir][Field][Units][Value]
#   6. Calculate Water Year and sum daily values to annual and 10-year running sums.
# David E. Rosenberg
# January 16, 2026
# Utah State University
# david.rosenberg@usu.edu
rm(list = ls())  #Clear history
# Load required libraries in 1 go
# List of packages
load.lib <- c("tidyverse", "readxl", "RColorBrewer", "dplyr", "expss", "reshape2", "pracma", "lubridate", "directlabels", "plyr", "stringr", "ggplot2", "ggpubr", "ggrepel", "zoo")
# Then we select only the packages that aren't currently installed.
install.lib <- load.lib[!load.lib %in% installed.packages()]
# And finally we install the missing packages, including their dependency.
for(lib in install.lib) install.packages(lib,dependencies=TRUE)
# After the installation process completes, we load all packages.
sapply(load.lib,require,character=TRUE)
# Read in meta data from Excel file
sExcelMeta <- 'USBRWebPortalMetaData.xlsx'
dfReservoirs <- read_excel(sExcelMeta, sheet = "Reservoirs")
dfFields <- read_excel(sExcelMeta, sheet = "Fields")
# Create a master data frame of reservoir data
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
# Loop over the reservoirs and fields
for (iRes in dfReservoirs$ResID) {
#for (iRes in 921) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
dfTemp <- try(read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=","))
if (!inherits(dfTemp, "try-error")) {
# Proceed with data processing if no error occurred
print(paste("Successfully read", sResFieldURL))
# Change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
# Add reservoir and field codes as new fields
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
#
#
dfResData <- rbind(dfResData,  dfTemp)
} else {
print(paste("Skipping", sResFieldURL, "due to an error"))
}
}
}
# Join in field and reservoir names and associated data
dfResData <- left_join(dfResData, dfReservoirs, by = "ResID")
dfResData <- left_join(dfResData, dfFields, by = "FieldID")
# Remove the first row
dfResData <- dfResData %>% slice(-1)
dDateInterval <- 365 # Days
#Convert date text to date value
# dfResData$DateValue <- as.POSIXct(dfResData$datetime)
dfResData$DateValue <- ymd(dfResData$datetime)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
nCFStoAFDay <- nCFStoAFMon/30.5
nCFSToAF <- nCFStoAFDay
#Calculate Day, Month, and Year
dfResData$Year <- year(dfResData$DateValue)
dfResData$Month <- month(dfResData$DateValue)
dfResData$Day <- day(dfResData$DateValue)
#Calculate Water Year
dfResData$WaterYear <- ifelse(dfResData$Month >= 10, dfResData$Year + 1, dfResData$Year)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes")
View(dfTempAgg)
dfFieldsAggByTimePeriod <- dfFields %>% filter(AggregateByTimePeriod == "Yes")
View(dfFieldsAggByTimePeriod)
dfTempAgg <- dfTempAgg %>% select(WaterYear, Month, ResID, ResName, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, Month, ResID, ResName, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(MonthlyTotal = sum(Value))
View(dfTempAgg)
dfTempNoAgg <- dfResData %>% filter(Day == 1)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes")
dfTempAgg <- dfTempAgg %>% select(WaterYear, Month, ResID, ResName, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, Month, ResID, ResName, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(MonthlyTotal = sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the month
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1)
View(dfTempAgg)
View(dfTempDay1)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, Month, ResID, ResName, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(MonthlyTotal = sum(Value))
dfTempDay1 <- dfResData %>% select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>% filter(AggregateByTimePeriod == "No", Day == 1)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
df
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
rename(MonthlyValue = Value)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dyplr::rename(MonthlyValue = Value)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(MonthlyValue = Value)
dfResDataMonthly <- rbind(dfTempAgg, dfTempDay1)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, ResID, ResName, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(Annual= sum(Value))
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, ResID, ResName, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(AnnualValue= sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the Water Year (October 1)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Month == 12, Day == 1) %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(AnnualValue = Value)
# Merge back into a single data frame
dfResDataAnnual <- rbind(dfTempAgg, dfTempDay1)
View(dfResDataAnnual)
dfResDataAnnual$AnnualValue <- ifelse(dfResDataAnnual$FieldUnits == "acre-feet", dfResDataAnnual$AnnualValue/ 1e6, dfResDataAnnual$AnnualValue )
dfResDataAnnual <- rbind(dfTempAgg, dfTempDay1)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(AnnualValue= sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the Water Year (October 1)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Month == 12, Day == 1) %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(AnnualValue = Value)
# Merge back into a single data frame
dfResDataAnnual <- rbind(dfTempAgg, dfTempDay1)
dfResDataAnnual$FieldUnits <- ifelse(dfResDataAnnual$FieldUnits == "acre-feet", "million acre-feet", dfResDataAnnual$FieldUnits )
dfResDataAnnual <- rbind(dfTempAgg, dfTempDay1)
### Convert acre-feet fields to Million Acre-Feet
dfResDataAnnual$AnnualValue <- ifelse(dfResDataAnnual$FieldUnits == "acre-feet", dfResDataAnnual$AnnualValue/ 1e6, dfResDataAnnual$AnnualValue )
dfResDataAnnual$FieldUnits <- ifelse(dfResDataAnnual$FieldUnits == "acre-feet", "million acre-feet", dfResDataAnnual$FieldUnits )
dfResDataMonthly$MonthlyValue <- ifelse(dfResDataMonthly$FieldUnits == "acre-feet", dfResDataMonthly$MonthlyValue/ 1e6, dfResDataMonthly$MonthlyValue )
dfResDataMonthly$FieldUnits <- ifelse(dfResDataMonthly$FieldUnits == "acre-feet", "million acre-feet", dfResDataMonthly$FieldUnits )
View(dfResDataMonthly)
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, Month, ResID, ResName, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(MonthlyValue = sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the month
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(MonthlyValue = Value)
# Merge back into a single Monthly data frame
dfResDataMonthly <- rbind(dfTempAgg, dfTempDay1)
### Convert acre-feet fields to Million Acre-Feet
dfResDataMonthly$MonthlyValue <- ifelse(dfResDataMonthly$FieldUnits == "acre-feet", dfResDataMonthly$MonthlyValue/ 1e6, dfResDataMonthly$MonthlyValue )
dfResDataMonthly$FieldUnits <- ifelse(dfResDataMonthly$FieldUnits == "acre-feet", "million acre-feet", dfResDataMonthly$FieldUnits )
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(MonthlyValue = sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the month
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(MonthlyValue = Value)
# Merge back into a single Monthly data frame
dfResDataMonthly <- rbind(dfTempAgg, dfTempDay1)
# AutoReadUSBRData.r
#
# This script auto reads USBR Lake Powell and Lake Mead data from Reclamation's HydroData Web portal
#
# https://www.usbr.gov/uc/water/hydrodata/reservoir_data/site_map.html
# This is a beginning R-programming effort! There could be lurking bugs or basic coding errors that I am not even aware of.
# Please report bugs/feedback to me (contact info below)
#
# We auto-read all Lake Powell (Code 919) and Lake Mead (921) available data at the daily time step.
#
# This data is:
#  Lake Powell (919) and field (code)
#     Storage - 17
#     Evaporation - 25
#     Inflow - 29
#     Inflow volume - 30
#     Unregulated inflow - 33
#     Unregulated inflow volume - 34
#     Total Release - 42
#     Release volume - 43
#     Area - 89
#     Pool elevation - 49
#  Lake Mead (921)
#     Storage - 17
#     Total Release - 42
#     Pool elevation - 49
#     Release volume - 43
#
#  The auto read URL command is:
#  'https://www.usbr.gov/uc/water/hydrodata/reservoir_data/RESID/csv/FIELDID.csv'
#
# The data wrangling strategy is:
#   1. Loop through Reservoirs and Fields
#   2.   Auto download the individual field CSV file format
#   2. Combine into one data frame for each reservoir with columns as fields
#   4. Clean and covert Reclamation's date format to a format R understands
#   5. Move into Narrow format - [Date][Reservoir][Field][Units][Value]
#   6. Calculate Water Year and sum daily values to annual and 10-year running sums.
# David E. Rosenberg
# January 16, 2026
# Utah State University
# david.rosenberg@usu.edu
rm(list = ls())  #Clear history
# Load required libraries in 1 go
# List of packages
load.lib <- c("tidyverse", "readxl", "RColorBrewer", "dplyr", "expss", "reshape2", "pracma", "lubridate", "directlabels", "plyr", "stringr", "ggplot2", "ggpubr", "ggrepel", "zoo")
# Then we select only the packages that aren't currently installed.
install.lib <- load.lib[!load.lib %in% installed.packages()]
# And finally we install the missing packages, including their dependency.
for(lib in install.lib) install.packages(lib,dependencies=TRUE)
# After the installation process completes, we load all packages.
sapply(load.lib,require,character=TRUE)
# Read in meta data from Excel file
sExcelMeta <- 'USBRWebPortalMetaData.xlsx'
dfReservoirs <- read_excel(sExcelMeta, sheet = "Reservoirs")
dfFields <- read_excel(sExcelMeta, sheet = "Fields")
# Create a master data frame of reservoir data
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
# Loop over the reservoirs and fields
for (iRes in dfReservoirs$ResID) {
#for (iRes in 921) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
dfTemp <- try(read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=","))
if (!inherits(dfTemp, "try-error")) {
# Proceed with data processing if no error occurred
print(paste("Successfully read", sResFieldURL))
# Change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
# Add reservoir and field codes as new fields
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
#
#
dfResData <- rbind(dfResData,  dfTemp)
} else {
print(paste("Skipping", sResFieldURL, "due to an error"))
}
}
}
# Join in field and reservoir names and associated data
dfResData <- left_join(dfResData, dfReservoirs, by = "ResID")
dfResData <- left_join(dfResData, dfFields, by = "FieldID")
# Remove the first row
dfResData <- dfResData %>% slice(-1)
dDateInterval <- 365 # Days
#Convert date text to date value
# dfResData$DateValue <- as.POSIXct(dfResData$datetime)
dfResData$DateValue <- ymd(dfResData$datetime)
# Convert CFS to Acre-feet per month
nCFStoAFMon <- 60.37
nCFStoAFDay <- nCFStoAFMon/30.5
nCFSToAF <- nCFStoAFDay
# Calculate Day, Month, and Year
dfResData$Year <- year(dfResData$DateValue)
dfResData$Month <- month(dfResData$DateValue)
dfResData$Day <- day(dfResData$DateValue)
# Calculate Water Year
dfResData$WaterYear <- ifelse(dfResData$Month >= 10, dfResData$Year + 1, dfResData$Year)
# Save the Daily data frame
dfResDataDaily <- dfResData
dfTemp <- dfResData %>% filter(Year == 2000, Month == 10, Day ==1)
### Aggregate and filter to Monthly values
# Aggregate To Monthly values for fields with AggregateToTimePeriod == Yes
dfFieldsAggByTimePeriod <- dfFields %>% filter(AggregateByTimePeriod == "Yes")
# For fields with AggregateToTimePeroid == Yes, we aggregate
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(MonthlyValue = sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the month
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Day == 1) %>%
select(WaterYear, Month, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(MonthlyValue = Value)
# Merge back into a single Monthly data frame
dfResDataMonthly <- rbind(dfTempAgg, dfTempDay1)
### Convert acre-feet fields to Million Acre-Feet
dfResDataMonthly$MonthlyValue <- ifelse(dfResDataMonthly$FieldUnits == "acre-feet", dfResDataMonthly$MonthlyValue/ 1e6, dfResDataMonthly$MonthlyValue )
dfResDataMonthly$FieldUnits <- ifelse(dfResDataMonthly$FieldUnits == "acre-feet", "million acre-feet", dfResDataMonthly$FieldUnits )
### Aggregate and filter to Water Year values
# Aggregate To WaterYear values for fields with AggregateToTimePeriod == Yes
dfTempAgg <- dfResData %>% filter(AggregateByTimePeriod == "Yes") %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
group_by(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits) %>%
dplyr::summarize(AnnualValue= sum(Value))
# For fields with AggregateToTimePeriod == No, we select the first day of the Water Year (October 1)
dfTempDay1 <- dfResData %>% filter(AggregateByTimePeriod == "No", Month == 12, Day == 1) %>%
select(WaterYear, ResID, ResName, ResNameAbbrev, FieldID, FieldName, FieldUnits, Value) %>%
dplyr::rename(AnnualValue = Value)
# Merge back into a single data frame
dfResDataAnnual <- rbind(dfTempAgg, dfTempDay1)
### Convert acre-feet fields to Million Acre-Feet
dfResDataAnnual$AnnualValue <- ifelse(dfResDataAnnual$FieldUnits == "acre-feet", dfResDataAnnual$AnnualValue/ 1e6, dfResDataAnnual$AnnualValue )
dfResDataAnnual$FieldUnits <- ifelse(dfResDataAnnual$FieldUnits == "acre-feet", "million acre-feet", dfResDataAnnual$FieldUnits )
#Trim first and last years with incomplete data
nFirstYear <- min(dfPowellAnnual$WaterYear) + 1
nLastYear <-  max(dfPowellAnnual$WaterYear)
nFirstYear <- min(dfResDataAnnual$WaterYear) + 1
nLastYear <-  max(dfResDataAnnual$WaterYear)
dfResDataAnnual <- dfResDataAnnual %>% filter(WaterYear > nFirstYear, WaterYear < nLastYear)
write.csv(dfResDataAnnual, "dfResDataAnnual.csv")
write.csv(dfResDataMonthly, "dfResDataMonthly.csv")
write.csv(dfResDataDaily, "dfResDataDaily.csv")

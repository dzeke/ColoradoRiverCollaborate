rm(list = ls())  #Clear history
# Load required libraries in 1 go
# List of packages
load.lib <- c("tidyverse", "readxl", "RColorBrewer", "dplyr", "expss", "reshape2", "pracma", "lubridate", "directlabels", "plyr", "stringr", "ggplot2", "ggpubr", "ggrepel", "zoo")
# Then we select only the packages that aren't currently installed.
install.lib <- load.lib[!load.lib %in% installed.packages()]
# And finally we install the missing packages, including their dependency.
for(lib in install.lib) install.packages(lib,dependencies=TRUE)
# After the installation process completes, we load all packages.
sapply(load.lib,require,character=TRUE)
# Create the meta data frame of reservoir and fields
# Read in meta data from Excel file
sExcelMeta <- 'USBRWebPortalMetaData.xlsx'
dfReservoirs <- read_excel(sExcellMeta, sheet = "Reservoirs")
dfFields <- read_excel(sExcellMeta, sheet = "Fields")
dfReservoirs <- read_excel(sExcelMeta, sheet = "Reservoirs")
dfFields <- read_excel(sExcelMeta, sheet = "Fields")
dfResData <- data.frame(ReservoirID = 0, FieldID = 0, Value = 0)
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
}
}
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
}
}
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
}
}
read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
},
error = {print(paste("Did not read ", sResFieldURL ))
})
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
# Read in the data
tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Append the temporary data frame
dfResData <- rbind(dfResData,  dfTemp)
},
error = {print(paste("Did not read ", sResFieldURL ))
})
}
}
dfTemp <- read.csv(file=sResFieldURL,
+                          header=TRUE,
+                          stringsAsFactors=FALSE,
+                          sep=",")
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
# Read in the data
tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Append the temporary data frame
dfResData <- rbind(dfResData,  dfTemp)
},
error = {print(paste("Did not read ", sResFieldURL ))
})
}
}
dfResData <- data.frame(ReservoirID = 0, FieldID = 0, Value = 0)
# Loop over the reservoirs and fields
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
# Read in the data
tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Append the temporary data frame
dfResData <- rbind(dfResData,  dfTemp)
},
error = {print(paste("Did not read ", sResFieldURL ))
})
}
}
sResFieldURL
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
dfResData <- rbind(dfResData,  dfTemp)
View(dfTemp)
dfResData <- data.frame(ResID = 0, FieldID = 0, Value = 0)
cnames(dfTemp)
cNames <- colnames(dfTemp)
cNames <- colnames(dfTemp)
cNames[2] <- 'Value'
colnames(cNames)
View(dfTemp)
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
cNames <- colnames(dfTemp)
dfTemp <- rename(dfTemp, Value = cNames[2])
dfTemp$FieldID <- iField
cNames[2]
rename(dfTemp, Value = cNames[2])
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfResData <- rbind(dfResData,  dfTemp)
dfResData <- data.frame(ResID = 0, Value = 0, FieldID = 0)
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfResData <- rbind(dfResData,  dfTemp)
View(dfResData)
dfResData <- data.frame(ResID = 0, Value = 0, FieldID = 0)
View(dfTemp)
dfResData <- data.frame(ResID = 0, datevalue = 0, Value = 0, FieldID = 0)
dfResData <- data.frame(ResID = 0, datevalue = 0, Value = 0, FieldID = 0)
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
dfResData <- rbind(dfResData,  dfTemp)
dfResData <- data.frame(datevalue = 0, Value = 0, FieldID = 0, ResID = 0)
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
dfResData <- rbind(dfResData,  dfTemp)
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
dfResData <- rbind(dfResData,  dfTemp)
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
# Read in the data
tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
dfResData <- rbind(dfResData,  dfTemp)
},
error = {print(paste("Did not read ", sResFieldURL ))
})
}
}
dfTemp <- read.csv(file="https://www.usbr.gov/uc/water/hydrodata/reservoir_data/919/csv/17.csv",
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
sResFieldURL <- 'https://www.usbr.gov/uc/water/hydrodata/reservoir_data/919/csv/17.csv''
sResFieldURL <- 'https://www.usbr.gov/uc/water/hydrodata/reservoir_data/919/csv/17.csv'
sResFieldURL <- 'https://www.usbr.gov/uc/water/hydrodata/reservoir_data/919/csv/17.csv'
read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
View(dfTemp)
sResFieldURL <- 'https://www.usbr.gov/uc/water/hydrodata/reservoir_data/919/csv/25.csv'
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
dfResData <- data.frame(datetime = 0, Value = 0, FieldID = 0, ResID = 0)
for (iRes in dfReservoirs$ResID) {
for (iField in dfFields$FieldID) {
# Create the url call
sResFieldURL <- paste0('https://www.usbr.gov/uc/water/hydrodata/reservoir_data/', iRes, '/csv/', iField,'.csv')
print(sResFieldURL)
# Read in the data
tryCatch({
dfTemp <- read.csv(file=sResFieldURL,
header=TRUE,
stringsAsFactors=FALSE,
sep=",")
#Add the Field ID and change the second column from the field name to value
colnames(dfTemp)[2] <- "Value"
dfTemp$FieldID <- iField
dfTemp$ResID <- iRes
dfResData <- rbind(dfResData,  dfTemp)
},
error = {print(paste("Did not read ", sResFieldURL ))
})
}
}
print(sResFieldURL)

##############
###   FIGURE 2
###   Plot ICS account balances over time
###############
ggplot() +
geom_bar(data=dfICSBalanceMelt %>% filter(variable != "Mexico"), aes(fill=variable,y=value/1e6,x=Year),position="stack", stat="identity") +
#geom_hline(yintercept = nMaxBalance$Total[2]/1e6, size = 2) +
#geom_line(data=dfMaxBalance, aes(color="Max Balance", y=MaxBal/1e6,x=Year), size=2) +
scale_fill_manual(name="Guide1",values = c(palBlues[3],palBlues[6],palBlues[9]),breaks=cColNames[1:3]) +
scale_color_manual(name="Guide2", values=c("Black")) +
#scale_x_continuous(breaks=seq(min(dfICSBalanceMelt$Year),max(dfICSBalanceMelt$Year),by=2),labels=seq(min(dfICSBalanceMelt$Year),max(dfICSBalanceMelt$Year),by=2)) +
#Secondary scale with total max balance
#scale_y_continuous(breaks=seq(0,3,by=1),labels=seq(0,3,by=1), sec.axis = sec_axis(~. +0, name = "", breaks = c(nMaxBalance$Total[2])/1e6, labels = c("Max Balance"))) +
#Secondary scale with individual state max balances
scale_y_continuous(breaks=seq(0,3,by=1),labels=seq(0,3,by=1)) + #, sec.axis = sec_axis(~. +0, name = "Maximum Balance", breaks = dfMaxBalanceCum$CumVal/1e6, labels = dfMaxBalanceCum$StateAsChar)) +
guides(fill = guide_legend(keywidth = 1, keyheight = 1), color=FALSE) +
theme_bw() +
labs(x="", y="Intentionally Created Surplus\nAccount Balance\n(MAF)") +
theme(text = element_text(size=20),  legend.title = element_blank(),
legend.text=element_text(size=18),
legend.position= c(0.1,0.80))
ggplot() +
geom_bar(data=dfICSDepositMelt, aes(fill=variable,y=value/1e6,x=Year),position="stack", stat="identity") +
#geom_line(data=dfMaxAnnualAmounts, aes(y=MaxDeposit/1e6,x=Year), size=2) +
#geom_line(data=dfMaxAnnualAmounts, aes(color="Max Withdrawal", y=-MaxWithdraw/1e6,x=Year), size=2) +
scale_fill_manual(name="Guide1",values = c(palBlues[3],palBlues[6],palBlues[9]),breaks=cColNames[1:3]) +
scale_color_manual(name="Guide2", values=c("Black","Black")) +
scale_x_continuous(breaks=seq(min(dfICSDepositMelt$Year),max(dfICSDepositMelt$Year),by=2),labels=seq(min(dfICSDepositMelt$Year),max(dfICSDepositMelt$Year),by=2)) +
#scale_y_continuous(sec.axis = sec_axis(~. +0, name = "", breaks = c(nMaxBalance$Total[1],-nMaxBalance$Total[3])/1e6, labels = c("Max Deposit","Max Withdraw"))) +
#scale_x_continuous(breaks = c(0,5,10,15,20,25),labels=c(0,5,10,15, 20,25), limits = c(0,as.numeric(dfMaxStor %>% filter(Reservoir %in% c("Mead")) %>% select(Volume))),
#                  sec.axis = sec_axis(~. +0, name = "Mead Level (feet)", breaks = dfMeadPoolsPlot$stor_maf, labels = dfMeadPoolsPlot$label)) +
guides(fill = guide_legend(keywidth = 1, keyheight = 1), color = FALSE) +
theme_bw() +
labs(x="", y="Deposit to Intentionally Created Surplus Account\n(MAF per year)") +
theme(text = element_text(size=20),  legend.title = element_blank(), legend.text=element_text(size=18),
legend.position= c(1.075,0.5))
##############
###   FIGURE 4
###   Plot Inflow by different methods as Time series
###############
ggplot() +
#Data after 1989
geom_line(data = dfInflowsToPlot %>% filter(Year < cYear), aes(x=Year , y=MeadInflow, color=Method, linetype=Method), size=1.5) +
theme_bw() +
scale_color_manual(values = cColorsToPlot) +
scale_linetype_manual(values = c("solid", "dotdash", "longdash", "dashed")) +
#Make one combined legend
guides(color = guide_legend(""), linetype = guide_legend("")) +
theme_bw() +
labs(x="", y="Lake Mead Inflow\n(MAF per year)", color="") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme(text = element_text(size=20))
##############
###   FIGURE 5
###   Plot Inflow as histogram
###############
ggplot() +
geom_histogram(data = dfInflowsToPlot %>% filter(Year < cYear), aes(x = MeadInflow), binwidth = 1, color = "Black", fill = "Blue") +
#geom_histogram(data = dfInflowsToPlot %>% filter(Method %in% cMethodsToPlot[2]), aes(x = MeadInflow), binwidth = 1, color = "Black", fill = "Red") +
facet_grid(. ~ Method) +
theme_bw() +
labs(x="Lake Mead Inflow\n(MAF per year)", y="Number of Years") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme(text = element_text(size=20),
legend.position = "none")
##############
###   FIGURE 6
##############
###   FIGURE 6
###   Plot inflow, available water, and ICS deposits as stacked area and stacked bar plots
###    Area for Inflow, Evaporation, Available Water
###    Bar for portion of ICS deposits to count/not count when there was sufficient available water
###############
lHistorialAllocation <- 9 # Historical allocations for California, Nevada, Arizona, and Mexico
# Baseline to calculate values to show in figure
lBaselinePlot <- 6   # Baseline value on plot from where bars for ICS deposits will show
# Inflow method to use
cMethodUse <- cMethods[4]
## Join the Inflow and ICS dataframes
dfInflowICS <- left_join(dfInflows %>% filter(Method == cMethodUse, Year < cYear), dfICSDeposit, by = c("Year" = "Year"))
## Joint the Inflow, ICS, and evaporation data frames
dfInflowICS <- left_join(dfInflowICS, dfUSBR_API_Agg %>% select(Year, Evaporation) %>% filter(Year < cYear), by = c("Year" = "Year"))
#Convert ICS values to million-acre feet
dfInflowICS$Arizona <- dfInflowICS$Arizona / 1e6
dfInflowICS$California <- dfInflowICS$California / 1e6
dfInflowICS$Nevada <- dfInflowICS$Nevada / 1e6
dfInflowICS$Mexico <- dfInflowICS$Mexico / 1e6
#Calculate Total ICS deposits each year (sum of positive values)
dfInflowICS$TotalDeposit <- ifelse(dfInflowICS$Arizona > 0, dfInflowICS$Arizona, 0) +
ifelse(dfInflowICS$California > 0, dfInflowICS$California, 0) +
ifelse(dfInflowICS$Nevada > 0, dfInflowICS$Nevada, 0)
#Calculate available water as inflow minus evaporation
dfInflowICS$AvailableWater <- 0
dfInflowICS$AvailableWater <- dfInflowICS$MeadInflow - dfInflowICS$Evaporation
#Replace NAs with zeros
dfInflowICS$TotalDeposit <- replace_na(dfInflowICS$TotalDeposit,0)
# Calculate the ICS deposits to count when there was sufficient available water
# There are 3 cases:
#   1. Available water greater than historical allocations => Count all ICS deposits
#   2. Available water between historical allocation and ICS amount => Count part of the ICS deposit
#   3. Available water less than historical allocation minus ICS deposits => Count none
dfInflowICS$CountICSDeposit <-
# Case 1
ifelse(dfInflowICS$AvailableWater >= lHistorialAllocation, dfInflowICS$TotalDeposit, 0) +
# Case 2
ifelse((dfInflowICS$AvailableWater < lHistorialAllocation) & (dfInflowICS$AvailableWater >= lHistorialAllocation - dfInflowICS$TotalDeposit), dfInflowICS$TotalDeposit - (lHistorialAllocation - dfInflowICS$AvailableWater), 0) +
# Case 3
ifelse(dfInflowICS$AvailableWater <= lHistorialAllocation - dfInflowICS$TotalDeposit, 0, 0)
# Calculate the ICS deposit not to count as difference between the TotalDeposit and Deposit counted
dfInflowICS$NotCountICSDeposit <- dfInflowICS$TotalDeposit - dfInflowICS$CountICSDeposit
sprintf("Total conservation credits all years: %.1f maf", sum(dfInflowICS$TotalDeposit))
sCreditTotals <- c(sprintf("Sufficient available water:\n%.1f maf", sum(dfInflowICS$CountICSDeposit)),
sprintf("Insufficient\navailable water:\n%.1f maf", sum(dfInflowICS$NotCountICSDeposit)))
#Melt the CountICSDeposit and NotCount columns into a new dataframe to plot as a stacked bar
cNamesInflowICS <- colnames(dfInflowICS)
nNumCols <- length(cNamesInflowICS)
dfICSCountMelt <- melt(data = dfInflowICS, id.vars = c("Year"), measure.vars = cNamesInflowICS[(nNumCols-1):nNumCols])
ggplot() +
#Ribbon from Inflow to available water
geom_ribbon(data = dfInflowICS, aes(x = Year, max = MeadInflow - lBaselinePlot, min = AvailableWater - lBaselinePlot, fill="Evaporation")) +
#Inflow as line
geom_line(data = dfInflowICS, aes(x= Year, y = MeadInflow - lBaselinePlot, color = "Inflow"), size = 1) + #color=Method shape=Method, size=6) +
#Available water as line
geom_line(data = dfInflowICS, aes(x= Year, y = AvailableWater - lBaselinePlot, color = "Available Water"), size = 1) + #color=Method shape=Method, size=6) +
# ICS counts as stacked bar
geom_bar(data=dfICSCountMelt, aes(fill=variable,y=-value,x=Year),position="stack", stat="identity") +
scale_fill_manual(name="Guide1",values = c(palGreys[1], palReds[7], palReds[9]),breaks=cNamesInflowICS[c(3, (nNumCols-1):nNumCols)], labels = c("Evaporation", sCreditTotals)) +
###scale_color_manual(name="Guide2", values=c("Black")) +
scale_color_manual(name="Guide2", values = c(palBlues[7], palBlues[9]), labels = c("Available Water", paste0("Inflow (", cMethodsToPlot,")"))) +
#Add line for 9.0 maf
geom_hline(yintercept = lHistorialAllocation - lBaselinePlot, color="black", linetype = "longdash", size = 1.5) +
# Set x-axis limits
xlim(min(dfUSBR_API_Agg$Year),max(dfUSBR_API_Agg$Year)) +
# Set the y-axis limits and breaks
scale_y_continuous(breaks=seq(-1,7,1), labels=c(1,0,seq(1,7,1) + lBaselinePlot)) +
#Make one combined legend
guides(color = guide_legend(""), fill = guide_legend("Conservation Credits")) +
#facet_wrap( ~ Source) +
labs(x="", y="Volume\n(million acre-feet per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
##############
###   FIGURE 7
###   Plot Inflow, Evaporation Table Look up, and Available water
###############
ggplot() +
#Evaporation
geom_point(data = dfUSBR_FromEvapTable, aes(x = Year, y = Evaporation, color = "Evaporation"), shape = 15, size = 6) + #color=Method shape=Method, size=6) +
#Add error bars to data points
#Mead
geom_errorbar(data=dfUSBR_FromEvapTable, aes(x=Year, ymin=Evaporation - EvaporationRange/2, ymax=EvaporationFromTable + EvaporationRange/2), width=.005,
position=position_dodge(0.2), color="black", show.legend = FALSE) +
#Inflow
geom_point(data = dfUSBR_FromEvapTable, aes(x = Year, y = MeadInflow, color = "Inflow"), shape = 16, size = 6) + #color=Method shape=Method, size=6) +
#Available water = Inflow - evaporation
geom_point(data = dfUSBR_FromEvapTable, aes(x = Year, y = MeadInflow - Evaporation, color = "Available Water"),  shape = 17,  size = 6) + #color=Method shape=Method, size=6) +
#Add line for 9.0 maf
geom_hline(yintercept = 9, color="red", linetype = "dashed") +
scale_fill_manual(values = cColorsToPlot) +
# Set x-axis limits
xlim(min(dfUSBR_API_Agg$Year),max(dfUSBR_API_Agg$Year)) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="", y="Volume\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
#################
###   FIGURE 8
###   Plot Mead Inflow as a box-and-whisker by different methods
#################
ggplot() +
geom_boxplot(data = dfInflowsToPlot, aes(x=Method , y=MeadInflow, fill=Method)) +
theme_bw() +
#Data before 1990
#geom_boxplot(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x="Before 1990 Natural Flow" , y=MeadInflow, fill="Before 1990 Natural Flow")) +
#scale_x_discrete(labels = c("Natural Flow" = "Natural Flow\n(1990 to 2016)", "Before 1990 Natural Flow" = "Natural Flow\n(1905 to 1989)", "USGS" = "USGS\n(1990 to 2016)") ) +
scale_fill_manual(values = cColorsToPlot) +
theme_bw() +
labs(x="", y="Lake Mead Inflow\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme(text = element_text(size=20),
legend.position = "none")
#################
###   FIGURE 9
###   Show the correlation between USGS and USBR estimates of inflow
#################
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfInflowsWide, aes(x= WaterYear, y=Diff),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x= LeeFerryNaturalFlow, y=MeadInflow, color="Natural Flow pre 1990", shape="Natural Flow pre 1990"), size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red", size = 1) +
#Add linear regression line
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=9, label.y=13, size = 6) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="USBR Back Calculation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
#################
###   FIGURE 10
###   Show the difference between USGS and USBR methods to estimate inflow
#################
ggplot() +
#Points after 1990 in Blue and Red
#geom_point(data = dfInflowsWide, aes(x= `USBR Application Program Interface`, y=`USGS Gages`),  size = 6) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare, aes(x= WaterYear, y=Diff),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x= LeeFerryNaturalFlow, y=MeadInflow, color="Natural Flow pre 1990", shape="Natural Flow pre 1990"), size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
#geom_abline(intercept = 0, slope = 1, linetype = "dash", color = red, size = 1) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="", y="Difference in Lake Mead Inflow\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
##Compare API Evaporation to Evaporation vs Volume curve
#Read in the evaporation vs storage data from dfMeadEvap
##############
###   FIGURE 11
###   Plot API Evaporation vs Table Look up
#############
ggplot() +
geom_point(data = dfUSBR_FromEvapTable %>% filter(Year < cYear), aes(x= Evaporation, y = EvaporationFromTable),  size = 6) + #color=Method shape=Method, size=6) +
#Add error bars to data points
#Mead
geom_errorbar(data=dfUSBR_FromEvapTable %>% filter(Year < cYear), aes(x=Evaporation,ymin=EvaporationFromTable - EvaporationRange/2, ymax=EvaporationFromTable + EvaporationRange/2), width=.005,
position=position_dodge(0.2), color="black", show.legend = FALSE) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red", size = 1) +
#Add linear regression line
geom_smooth(data = dfUSBR_FromEvapTable %>% filter(Year < cYear), aes(x= Evaporation, y = EvaporationFromTable),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation to plot
stat_regline_equation(data = dfUSBR_FromEvapTable %>% filter(Year < cYear), aes(x= Evaporation, y = EvaporationFromTable),
label.x= mean(dfUSBR_FromEvapTable$Evaporation), label.y=mean(dfUSBR_FromEvapTable$EvaporationFromTable), size = 6) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Evaporation USBR API\n(MAF per year)", y="Evaporation from Table\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
##
# Not working beyond here
## Show the correlation matrix
mCorr <- cor(as.data.frame(dfInflowsWide %>% filter(WaterYear >= 2005, WaterYear < 2023) %>%  select(`USGS Gages`,`USBR Application Program Interface`) ))
print(paste("Correlation = ",round(mCorr[1,2],2)))
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfInflowsWide, aes(x= WaterYear, y=Diff),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x= LeeFerryNaturalFlow, y=MeadInflow, color="Natural Flow pre 1990", shape="Natural Flow pre 1990"), size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red", size = 1) +
#Add linear regression line
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=9, label.y=13, size = 6) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="USBR Back Calculation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
View(dfInflowCompare)
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'Blue'),  size = 6) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'Purple'),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfInflowsWide, aes(x= WaterYear, y=Diff),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x= LeeFerryNaturalFlow, y=MeadInflow, color="Natural Flow pre 1990", shape="Natural Flow pre 1990"), size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "red", size = 1) +
#Add linear regression line
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=9, label.y=13, size = 6) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="USBR Back Calculation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'Purple'),  size = 5) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'Blue'),  size = 5) + #color=Method shape=Method, size=6) +
#geom_point(data = dfInflowsWide, aes(x= WaterYear, y=Diff),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x= LeeFerryNaturalFlow, y=MeadInflow, color="Natural Flow pre 1990", shape="Natural Flow pre 1990"), size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "black", size = 1) +
#Add linear regression line
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth",
color = "red") +
#Add regression equation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=8.5, label.y=12, size = 5) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Reclamation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'Purple'),  size = 5) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'Blue'),  size = 5) + #color=Method shape=Method, size=6) +
#geom_point(data = dfInflowsWide, aes(x= WaterYear, y=Diff),  size = 6) + #color=Method shape=Method, size=6) +
#geom_point(data = dfGCFDataToUse %>% filter(WaterYear < 1990), aes(x= LeeFerryNaturalFlow, y=MeadInflow, color="Natural Flow pre 1990", shape="Natural Flow pre 1990"), size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "black", size = 1) +
#Add linear regression line
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth",
color = "red") +
#Add regression equation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=8.5, label.y=12, size = 5, color = 'red') +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Reclamation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'Purple'),  size = 5) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'Blue'),  size = 5) + #color=Method shape=Method, size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "black", size = 1) +
#Add linear regression line for Reclamation API Inflow
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth",
color = "red") +
#Add regression equation for Reclamation API Inflow to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=8.5, label.y=12, size = 5, color = 'red') +
#Add linear regression line for Reclamation API Back Calculation
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth",
color = "blue") +
#Add regression equation for Reclamation Inflow to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=12, label.y=10.5, size = 5, color = 'blue') +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Reclamation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'Purple'),  size = 5) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'Blue'),  size = 5) + #color=Method shape=Method, size=6) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#scale_color_manual(values=c("Blue","Red","Pink"), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "black", size = 1) +
#Add linear regression line for Reclamation API Inflow
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth",
color = "red") +
#Add regression equation for Reclamation API Inflow to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`),
label.x=8.5, label.y=12, size = 5, color = 'red') +
#Add linear regression line for Reclamation API Back Calculation
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`),
method = "lm",
formula = y ~ x,
geom = "smooth",
color = "blue") +
#Add regression equation for Reclamation Inflow to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`),
label.x=12, label.y=10.5, size = 5, color = 'blue') +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Reclamation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
#################
###   FIGURE 9
###   Show the correlation between USGS and USBR estimates of inflow
#################
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'API Back Calc'),  size = 5) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'API Inflow'),  size = 5) + #color=Method shape=Method, size=6) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "black", size = 1) +
#Add linear regression line for Reclamation API Inflow
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'API Inflow'),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation for Reclamation API Inflow to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'API Inflow'),
label.x=8.5, label.y=12, size = 5, ) +
#Add linear regression line for Reclamation API Back Calculation
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = "USBR API Back Calc"),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation for Reclamation API Back Calculation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = "USBR API Back Calc" ),
label.x=12, label.y=10.5, size = 5) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
scale_color_manual(values=c("Blue","Red"), breaks = c('API Inflow', 'API Back Calc')) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Reclamation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
#################
###   FIGURE 9
###   Show the correlation between USGS and USBR estimates of inflow
#################
ggplot() +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = 'API Back Calc'),  size = 5) + #color=Method shape=Method, size=6) +
geom_point(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'API Inflow'),  size = 5) + #color=Method shape=Method, size=6) +
#Add 1:1 line
geom_abline(intercept = 0, slope = 1, linetype = "dashed", color = "black", size = 1) +
#Add linear regression line for Reclamation API Inflow
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'API Inflow'),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation for Reclamation API Inflow to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Inflow`, y=`USGS Gages`, color = 'API Inflow'),
label.x=8.5, label.y=12, size = 5, ) +
#Add linear regression line for Reclamation API Back Calculation
geom_smooth(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = "API Back Calc"),
method = "lm",
formula = y ~ x,
geom = "smooth") +
#Add regression equation for Reclamation API Back Calculation to plot
stat_regline_equation(data = dfInflowCompare %>% filter(Year < cYear), aes(x= `USBR API Back Calc`, y=`USGS Gages`, color = "API Back Calc" ),
label.x=12, label.y=10.5, size = 5) +
#scale_shape_manual(values=c(17,16,16), breaks = c("USGS","Natural Flow","Natural Flow pre 1990"), labels  = c("USGS (after 1990)","Natural Flow (after 1990)","Natural Flow (before 1990)")) +
scale_color_manual(values=c("Blue","Red"), breaks = c('API Inflow', 'API Back Calc')) +
#Make one combined legend
guides(color = guide_legend("Dataset"), shape = guide_legend("Dataset")) +
#facet_wrap( ~ Source) +
labs(x="Reclamation\n(MAF per year)", y="USGS Gages\n(MAF per year)") +
#theme(text = element_text(size=20), legend.title=element_blank(), legend.text=element_text(size=18),
#      legend.position = c(0.8,0.7))
theme_bw() +
theme(text = element_text(size=20))
